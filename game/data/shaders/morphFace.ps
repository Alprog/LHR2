
varying vec4 v_fragmentColor;    
varying vec2 v_texCoord;
varying vec2 v_texCoord1;

uniform sampler2D texture_0;
uniform sampler2D texture_1;
uniform float k;

uniform float sharp;

//CC_Time[1] is time, automatically updated by Cocos2d-x.

void main()            
{	
	float dx = 1.0 / 480.0;
	float dy = 1.0 / 640.0;

	vec4 sum = vec4(0.0, 0.0, 0.0, 0.0);
	
	vec2 t1 = v_texCoord;
	vec2 t2 = v_texCoord1;

	vec4 c0 = texture2D(texture_0, t1);
	vec4 c1 = texture2D(texture_1, t2);

	sum += mix(c0, c1, k) * (1.0 + sharp * 4.0);

	t1.x -= dx;
	t2.x -= dx;

	c0 = texture2D(texture_0, t1);
	c1 = texture2D(texture_1, t2);
	sum -= mix(c0, c1, k) * sharp;

	t1.x += dx * 2.0;
	t2.x += dx * 2.0;

	c0 = texture2D(texture_0, t1);
	c1 = texture2D(texture_1, t2);
	sum -= mix(c0, c1, k) * sharp;

	t1.x -= dx;
	t2.x -= dx;
	t1.y -= dy;
	t2.y -= dy;

	c0 = texture2D(texture_0, t1);
	c1 = texture2D(texture_1, t2);
	sum -= mix(c0, c1, k) * sharp;

	t1.y += dy * 2.0;
	t2.y += dy * 2.0;

	c0 = texture2D(texture_0, t1);
	c1 = texture2D(texture_1, t2);
	sum -= mix(c0, c1, k) * sharp;

	gl_FragColor = sum;
}
