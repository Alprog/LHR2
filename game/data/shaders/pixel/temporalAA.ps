
varying vec2 v_texCoord;
varying vec3 v_normal;

uniform sampler2D mainTexture;
uniform sampler2D velocityTexture;
uniform sampler2D historyTexture;
uniform vec2 veloOffset;

void main()
{	
	vec4 mainColor = texture2D(mainTexture, v_texCoord);
    vec2 velocity = texture2D(velocityTexture, v_texCoord).xy + veloOffset;
    
    
    float power = clamp(length(velocity) * 200, 0.2, 1);
    vec4 historyColor = texture2D(historyTexture, v_texCoord - velocity / 2);
    
    //vec3 d = historyColor.rgb - mainColor.rgb;
    //if (abs(d.r) + abs(d.g) + abs(d.b) > 2) power = 1;
    
    gl_FragColor = mix(historyColor, mainColor, power);
    
}
